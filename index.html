<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>AI 助理</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
body {
  margin: 0;
  background: #0f172a;
  color: white;
  font-family: system-ui;
}
#chat {
  height: 85vh;
  overflow-y: auto;
  padding: 14px;
}
.msg {
  margin-bottom: 10px;
  display: flex;
}
.user { justify-content: flex-end; }
.ai { justify-content: flex-start; }
.bubble {
  max-width: 75%;
  padding: 10px 14px;
  border-radius: 18px;
}
.user .bubble {
  background: #2563eb;
}
.ai .bubble {
  background: #1f2933;
}
.footer {
  display: flex;
  gap: 6px;
  padding: 10px;
}
textarea {
  flex: 1;
  border-radius: 12px;
}
button {
  border-radius: 999px;
}
img {
  max-width: 150px;
  border-radius: 10px;
}
</style>
</head>
<body>

<div id="chat"></div>

<div class="footer">
  <input type="file" id="img" />
  <textarea id="text"></textarea>
  <button onclick="send()">送出</button>
</div>

<script>
const BASE_URL = "https://schedule-bot-production-32ae.up.railway.app";

const chat = document.getElementById("chat");
const textEl = document.getElementById("text");
const imgEl = document.getElementById("img");

function add(role, msg, img=null){
  const div = document.createElement("div");
  div.className = "msg " + role;
  const b = document.createElement("div");
  b.className = "bubble";
  b.textContent = msg;
  if(img){
    const i = document.createElement("img");
    i.src = img;
    b.appendChild(i);
  }
  div.appendChild(b);
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

async function send(){
  const text = textEl.value.trim();
  const file = imgEl.files[0];
  if(!text && !file) return;

  const preview = file ? URL.createObjectURL(file) : null;
  add("user", text || "（已上傳圖片）", preview);
  textEl.value = "";
  imgEl.value = "";

  add("ai", "…分析中");

  const form = new FormData();
  form.append("message", text);
  if(file) form.append("image", file);

  const res = await fetch(`${BASE_URL}/chat`, {
    method:"POST",
    body: form
  });

  const data = await res.json();

  chat.lastChild.remove();
  add("ai", data.reply);
}
</script>

</body>
</html>
