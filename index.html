<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>AI åŠ©ç†</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
:root{
  --bg-dark:#020617;
  --bg-light:#f8fafc;
  --glass-dark:rgba(20,20,20,.72);
  --glass-light:rgba(255,255,255,.75);
  --user:#2563eb;
  --ai:rgba(255,255,255,.85);
  --text-dark:#f9fafb;
  --text-light:#020617;
}
body{
  margin:0;
  font-family:system-ui;
  height:100vh;
  background:radial-gradient(circle at 20% 20%,#1e293b,#020617);
  overflow:hidden;
  display:flex;
}
body.light{
  background:radial-gradient(circle at 20% 20%,#e2e8f0,#f8fafc);
}

/* âœ… æƒæç·š + ç»ç’ƒé›œè¨Š */
body::before,body::after{
  content:"";
  position:fixed;
  inset:0;
  pointer-events:none;
}
body::before{
  background:
  repeating-linear-gradient(
    to bottom,
    rgba(255,255,255,.04), 
    rgba(255,255,255,.04) 1px,
    transparent 2px,
    transparent 4px
  );
  animation:scan 6s linear infinite;
}
body::after{
  background-image:url("https://www.transparenttextures.com/patterns/asfalt-light.png");
  opacity:.15;
}
@keyframes scan{
  0%{transform:translateY(-100%)}
  100%{transform:translateY(100%)}
}

/* âœ… å´é‚Šæ¬„ */
.sidebar{
  width:260px;
  background:rgba(0,0,0,.4);
  backdrop-filter:blur(14px);
  padding:14px;
  color:white;
  transform:translateX(-100%);
  transition:.3s;
  overflow-y:auto;
}
.sidebar.open{transform:none}
.sidebar h3{text-align:center;font-size:14px}
.sidebar .item{
  font-size:12px;
  background:rgba(255,255,255,.12);
  padding:8px;
  border-radius:10px;
  margin-bottom:8px;
}

/* âœ… ä¸»å¡ç‰‡ */
.app{
  flex:1;
  margin:18px;
  border-radius:24px;
  backdrop-filter:blur(18px);
  background:var(--glass-dark);
  display:flex;
  flex-direction:column;
  overflow:hidden;
  box-shadow:0 20px 80px rgba(0,0,0,.6);
}
body.light .app{background:var(--glass-light)}

/* Header */
.header{
  padding:14px;
  color:white;
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-weight:700;
}
.toggle{cursor:pointer}

/* Chat */
.chat{
  flex:1;
  padding:20px;
  overflow-y:auto;
  -webkit-overflow-scrolling:touch;
}
.msg{display:flex;margin-bottom:12px;animation:fade .3s}
.user{justify-content:flex-end}
.ai{justify-content:flex-start}
.bubble{
  max-width:76%;
  padding:12px 16px;
  border-radius:18px;
  box-shadow:0 8px 26px rgba(0,0,0,.35);
  line-height:1.6;
  animation:breathe 3s infinite;
}
.user .bubble{background:var(--user);color:white}
.ai .bubble{background:var(--ai);color:black}
body.light .ai .bubble{color:black}

/* footer */
.footer{
  padding:14px;
  display:flex;
  flex-direction:column;
  gap:8px;
}
textarea{
  border:none;
  border-radius:12px;
  padding:10px;
  font-size:15px;
}
.controls{display:flex;gap:8px}
button{
  flex:1;
  border:none;
  border-radius:999px;
  background:#2563eb;
  color:white;
  padding:10px;
  cursor:pointer;
}
.time{font-size:11px;opacity:.6;margin-top:4px}
.thinking{opacity:.5;animation:blink 1.2s infinite}

@keyframes fade{from{opacity:0;transform:translateY(6px)}}
@keyframes blink{50%{opacity:1}}
@keyframes breathe{
  50%{box-shadow:0 12px 40px rgba(0,0,0,.55)}
}
</style>
</head>

<body>

<!-- âœ… æ­·å²ç´€éŒ„å´é‚Šæ¬„ -->
<div id="side" class="sidebar">
  <h3>ğŸ—‚ å°è©±ç´€éŒ„</h3>
  <div id="history"></div>
</div>

<div class="app">
  <div class="header">
    âœ¨ AI åŠ©ç†
    <div>
      <span id="menu">ğŸ“œ</span>
      <span id="theme">ğŸŒ“</span>
    </div>
  </div>

  <div id="chat" class="chat"></div>

  <div class="footer">
    <textarea id="input" placeholder="è¼¸å…¥æ–‡å­—æˆ–èªéŸ³â€¦"></textarea>
    <div class="controls">
      <button id="mic">ğŸ¤</button>
      <button id="send">é€å‡º</button>
    </div>
  </div>
</div>

<script>
const BASE_URL="https://schedule-bot-production-32ae.up.railway.app";
const chat=document.getElementById("chat");
const input=document.getElementById("input");
const sendBtn=document.getElementById("send");
const side=document.getElementById("side");
const menu=document.getElementById("menu");
const themeBtn=document.getElementById("theme");
const historyEl=document.getElementById("history");

menu.onclick=()=>side.classList.toggle("open");
themeBtn.onclick=()=>{
  document.body.classList.toggle("light");
  localStorage.setItem("theme",document.body.classList.contains("light"));
}
if(localStorage.getItem("theme")==="true")document.body.classList.add("light");

/* âœ… LocalStorage */
let logs=JSON.parse(localStorage.getItem("chat")||"[]");
logs.forEach(m=>render(m.role,m.text));

function save(role,text){
  logs.push({role,text});
  localStorage.setItem("chat",JSON.stringify(logs));
  const div=document.createElement("div");
  div.className="item";
  div.textContent=text.slice(0,20);
  historyEl.appendChild(div);
}

/* âœ… èªéŸ³è¼¸å…¥ */
const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
if(SR){
  const r=new SR();
  r.lang="zh-TW";
  document.getElementById("mic").onclick=()=>r.start();
  r.onresult=e=>input.value=e.results[0][0].transcript;
}

/* âœ… ç™¼é€ */
sendBtn.onclick=async()=>{
  const text=input.value.trim();
  if(!text)return;
  render("user",text);save("user",text);input.value="";
  const thinking=render("ai","æ€è€ƒä¸­â€¦",true);
  const start=performance.now();
  const res=await fetch(`${BASE_URL}/chat`,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({message:text})
  });
  const d=await res.json();
  thinking.remove();
  typeWrite(d.reply,(performance.now()-start).toFixed(0));
}

function render(role,text,load){
  const d=document.createElement("div");
  d.className="msg "+(role==="user"?"user":"ai");
  const b=document.createElement("div");
  b.className="bubble";
  if(load)b.classList.add("thinking");
  b.textContent=text;
  d.appendChild(b);
  chat.appendChild(d);
  chat.scrollTop=chat.scrollHeight;
  return d;
}

function typeWrite(text,time){
  const d=render("ai","");
  const b=d.querySelector(".bubble");
  let i=0;
  const t=setInterval(()=>{
    b.textContent+=text[i++];
    if(i>=text.length){
      clearInterval(t);
      const tm=document.createElement("div");
      tm.className="time";
      tm.textContent=`â± ${time}ms`;
      b.appendChild(tm);
      speak(text);
      save("ai",text);
    }
  },18);
}

function speak(text){
  const u=new SpeechSynthesisUtterance(text);
  u.lang="zh-TW";speechSynthesis.speak(u);
}
</script>
</body>
</html>
