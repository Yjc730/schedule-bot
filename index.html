<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>AI åŠ©ç†</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
:root {
  --bg-dark: linear-gradient(135deg, #020617, #0f172a);
  --bg-light: linear-gradient(135deg, #f8fafc, #e5e7eb);
  --glass: rgba(255,255,255,.08);
  --glass-dark: rgba(30,30,30,.65);
  --bubble-user: linear-gradient(135deg, #3b82f6, #2563eb);
  --bubble-ai: rgba(255,255,255,.9);
  --bubble-ai-dark: rgba(40,40,40,.85);
  --text-dark: #f9fafb;
  --text-light: #0f172a;
}
body {
  margin: 0;
  height: 100vh;
  font-family: system-ui;
  background: var(--bg-dark);
  color: var(--text-dark);
  overflow: hidden;
}
body.light {
  background: var(--bg-light);
  color: var(--text-light);
}

/* âœ… æƒæç·š + ç»ç’ƒé›œè¨Šç§‘æŠ€å±¤ */
body::after {
  content: "";
  position: fixed;
  inset: 0;
  background:
    repeating-linear-gradient(
      to bottom,
      rgba(255,255,255,0.03),
      rgba(255,255,255,0.03) 1px,
      transparent 2px,
      transparent 4px
    ),
    linear-gradient(
      to bottom,
      transparent 0%,
      rgba(255,255,255,0.12) 50%,
      transparent 100%
    );
  animation: scan 6s linear infinite;
  pointer-events: none;
  z-index: 0;
}
@keyframes scan {
  from { background-position-y: -100%; }
  to { background-position-y: 100%; }
}

/* âœ… ç‰ˆé¢å®¹å™¨ */
.wrapper {
  position: relative;
  width: 100%;
  height: 100%;
  display: flex;
}

/* âœ… å´é‚Šæ­·å²ç´€éŒ„ */
.sidebar {
  width: 280px;
  background: rgba(0,0,0,.6);
  backdrop-filter: blur(18px);
  border-right: 1px solid rgba(255,255,255,.2);
  position: absolute;
  left: -280px;
  top: 0;
  bottom: 0;
  transition: .35s ease;
  z-index: 20;
  display: flex;
  flex-direction: column;
}
.sidebar.show {
  left: 0;
}
.sidebar h3 {
  margin: 0;
  padding: 16px;
  border-bottom: 1px solid rgba(255,255,255,.2);
}
.history {
  flex: 1;
  overflow-y: auto;
  padding: 12px;
  font-size: 13px;
  opacity: .8;
}

/* âœ… ä¸»èŠå¤©å®¤æ»¿ç‰ˆ */
.app {
  flex: 1;
  margin: 16px;
  border-radius: 24px;
  background: var(--glass-dark);
  backdrop-filter: blur(18px);
  box-shadow: 0 20px 80px rgba(0,0,0,.5);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  transition: .35s ease;
  z-index: 10;
}
.shift {
  margin-left: 296px;
}

body.light .app {
  background: rgba(255,255,255,.85);
}

/* âœ… Header */
.header {
  padding: 14px;
  border-bottom: 1px solid rgba(255,255,255,.2);
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.toggle {
  cursor: pointer;
  font-size: 20px;
}

/* âœ… èŠå¤©æ¡† */
.chat {
  flex: 1;
  padding: 18px;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
}
.message {
  display: flex;
  margin-bottom: 12px;
}
.user { justify-content: flex-end; }
.assistant { justify-content: flex-start; }
.bubble {
  padding: 12px 16px;
  border-radius: 18px;
  max-width: 78%;
  line-height: 1.6;
  animation: breathe 3s infinite;
}
.user .bubble {
  background: var(--bubble-user);
  color: white;
}
.assistant .bubble {
  background: var(--bubble-ai-dark);
}
body.light .assistant .bubble {
  background: var(--bubble-ai);
  color: var(--text-light);
}
.thinking { opacity:.6; animation: blink 1.4s infinite; }

/* âœ… è¼¸å…¥å€ */
.footer {
  padding: 12px;
  border-top: 1px solid rgba(255,255,255,.2);
  display: flex;
  flex-direction: column;
  gap: 8px;
}
textarea {
  resize: none;
  padding: 10px;
  border-radius: 12px;
  border: none;
}
.controls {
  display: flex;
  gap: 8px;
}
button {
  flex: 1;
  padding: 10px;
  border: none;
  border-radius: 999px;
  background: #2563eb;
  color: white;
  cursor: pointer;
}

/* âœ… å‹•ç•« */
@keyframes breathe {
  0% { box-shadow: 0 4px 12px rgba(0,0,0,.2); }
  50% { box-shadow: 0 8px 24px rgba(0,0,0,.4); }
  100% { box-shadow: 0 4px 12px rgba(0,0,0,.2); }
}
@keyframes blink {
  0% {opacity:.3} 50%{opacity:1} 100%{opacity:.3}
}
</style>
</head>

<body>

<div class="wrapper">
  <!-- âœ… å´é‚Šæ­·å² -->
  <div id="sidebar" class="sidebar">
    <h3>ğŸ“œ èŠå¤©è¨˜éŒ„</h3>
    <div id="history" class="history"></div>
  </div>

  <!-- âœ… ä¸»èŠå¤©å®¤ -->
  <div id="app" class="app">
    <div class="header">
      âœ¨ AI åŠ©ç†
      <div>
        <span id="historyBtn" class="toggle">ğŸ“œ</span>
        <span id="themeBtn" class="toggle">ğŸŒ“</span>
      </div>
    </div>
    <div id="chat" class="chat"></div>

    <div class="footer">
      <textarea id="input" placeholder="è¼¸å…¥æ–‡å­—æˆ–ç”¨èªéŸ³â€¦"></textarea>
      <div class="controls">
        <button id="mic">ğŸ¤</button>
        <button id="send">é€å‡º</button>
      </div>
    </div>
  </div>
</div>

<script>
const BASE_URL = "https://schedule-bot-production-32ae.up.railway.app";
const chat = document.getElementById("chat");
const input = document.getElementById("input");
const send = document.getElementById("send");
const mic = document.getElementById("mic");
const themeBtn = document.getElementById("themeBtn");
const historyBtn = document.getElementById("historyBtn");
const sidebar = document.getElementById("sidebar");
const app = document.getElementById("app");
const historyBox = document.getElementById("history");

/* âœ… ä¸»é¡Œ */
if (localStorage.getItem("theme")==="light") document.body.classList.add("light");
themeBtn.onclick = ()=> {
  document.body.classList.toggle("light");
  localStorage.setItem("theme", document.body.classList.contains("light")?"light":"dark");
};

/* âœ… å´æ¬„ */
historyBtn.onclick = ()=> {
  sidebar.classList.toggle("show");
  app.classList.toggle("shift");
};

/* âœ… è¼‰å…¥æ­·å² */
const historyData = JSON.parse(localStorage.getItem("chat_history")||"[]");
historyData.forEach(m=>{
  render(m.role, m.text);
  historyBox.innerHTML += `<div>â€¢ ${m.text}</div>`;
});

/* âœ… èªéŸ³ */
const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
const recog = SR ? new SR() : null;
if (recog) {
  recog.lang="zh-TW";
  mic.onclick = ()=>recog.start();
  recog.onresult=e=>input.value=e.results[0][0].transcript;
}

/* âœ… ç™¼é€ */
send.onclick = async ()=>{
  const text=input.value.trim();
  if(!text) return;
  render("user",text);
  save("user",text);
  const thinking = render("assistant","â€¦ æ€è€ƒä¸­",true);
  input.value="";
  try{
    const res = await fetch(`${BASE_URL}/chat`,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({message:text})
    });
    const data=await res.json();
    thinking.remove();
    typeWriter(data.reply);
  }catch{
    thinking.textContent="âŒ é€£ç·šå¤±æ•—";
  }
};

/* âœ… å·¥å…· */
function render(role,text,loading=false){
  const d=document.createElement("div");
  d.className=`message ${role}`;
  const b=document.createElement("div");
  b.className="bubble";
  if(loading) b.classList.add("thinking");
  b.textContent=text;
  d.appendChild(b);
  chat.appendChild(d);
  chat.scrollTop=chat.scrollHeight;
  return b;
}
function typeWriter(text){
  let i=0;
  const b=render("assistant","");
  const timer=setInterval(()=>{
    b.textContent+=text[i++];
    chat.scrollTop=chat.scrollHeight;
    if(i>=text.length){
      clearInterval(timer);
      speak(text);
      save("assistant",text);
    }
  },18);
}
function save(role,text){
  const data=JSON.parse(localStorage.getItem("chat_history")||"[]");
  data.push({role,text});
  localStorage.setItem("chat_history",JSON.stringify(data));
  historyBox.innerHTML+=`<div>â€¢ ${text}</div>`;
}
function speak(t){
  const u=new SpeechSynthesisUtterance(t);
  u.lang="zh-TW";
  speechSynthesis.speak(u);
}
</script>
</body>
</html>
