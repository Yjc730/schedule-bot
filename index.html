<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>è¡Œäº‹æ›†èŠå¤©æ©Ÿå™¨äºº Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 16px;
    }
    h1 {
      text-align: center;
      margin-bottom: 8px;
    }
    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 24px;
      font-size: 14px;
    }
    .card {
      background: #fff;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
    }
    .card h2 {
      margin-top: 0;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .label {
      font-size: 14px;
      margin-bottom: 4px;
      color: #333;
    }
    textarea, input[type="text"] {
      width: 100%;
      box-sizing: border-box;
      padding: 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 14px;
      resize: vertical;
    }
    textarea {
      min-height: 80px;
    }
    button {
      border: none;
      padding: 8px 16px;
      border-radius: 999px;
      font-size: 14px;
      cursor: pointer;
      background: #2563eb;
      color: #fff;
      margin-top: 8px;
    }
    button:disabled {
      opacity: 0.6;
      cursor: default;
    }
    .output {
      margin-top: 8px;
      background: #f9fafb;
      border-radius: 8px;
      padding: 8px;
      font-size: 13px;
      white-space: pre-wrap;
      max-height: 260px;
      overflow: auto;
    }
    .small {
      font-size: 12px;
      color: #888;
    }
    .events-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
      margin-top: 8px;
    }
    .events-table th,
    .events-table td {
      border: 1px solid #e5e7eb;
      padding: 4px 6px;
      text-align: left;
    }
    .events-table th {
      background: #f3f4f6;
    }
    .pill {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      background: #e5e7eb;
      font-size: 11px;
      margin-left: 4px;
    }
    input[type="file"] {
      font-size: 13px;
      margin-top: 4px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>è¡Œäº‹æ›†èŠå¤©æ©Ÿå™¨äºº Demo</h1>
    <div class="subtitle">
      ç°¡æ˜“ç‰ˆï¼šèŠå¤©ã€è§£ææ–‡å­—è¡Œç¨‹ã€åœ–ç‰‡è¡Œç¨‹ï¼ˆå¾Œç«¯è«‹å…ˆè·‘åœ¨ <code>localhost:8000</code>ï¼‰
    </div>

    <!-- ä¸€èˆ¬èŠå¤© -->
    <div class="card">
      <h2>ğŸ’¬ ä¸€èˆ¬èŠå¤©</h2>
      <div class="label">è¨Šæ¯å…§å®¹ï¼š</div>
      <textarea id="chat-input" placeholder="è·Ÿæ©Ÿå™¨äººèŠèŠå¤©ï¼Œæˆ–å•å®ƒä»Šå¤©è¦åšä»€éº¼ï½"></textarea>
      <button id="chat-send">é€å‡º</button>
      <div class="output" id="chat-output"></div>
    </div>

    <!-- æ–‡å­—è¡Œç¨‹è§£æ -->
    <div class="card">
      <h2>ğŸ—“ è§£ææ–‡å­—è¡Œç¨‹ <span class="pill">/parse-schedule-text</span></h2>
      <div class="label">è¡Œç¨‹æ–‡å­—ï¼š</div>
      <textarea id="schedule-text-input" placeholder="ä¾‹å¦‚ï¼šé€™ç¦®æ‹œäºŒä¸‹åˆä¸€é»åˆ°å…©é»æ‰“æƒï¼Œç¦®æ‹œä¸‰æ—©ä¸Šåé»é–‹æœƒã€‚"></textarea>
      <div class="label small">
        åƒè€ƒæ—¥æœŸï¼ˆç”¨ä¾†è§£æã€Œé€™ç¦®æ‹œäºŒã€ä¹‹é¡çš„ç›¸å°æ—¥æœŸï¼‰ï¼Œç©ºç™½å‰‡ç”¨ä»Šå¤©ï¼š
      </div>
      <input type="text" id="reference-date-input" placeholder="2025-11-21ï¼ˆå¯é¸ï¼‰" />
      <button id="schedule-text-send">è§£æè¡Œç¨‹</button>
      <div class="output" id="schedule-text-output"></div>
      <div id="schedule-text-table"></div>
    </div>

    <!-- åœ–ç‰‡è¡Œç¨‹è§£æ -->
    <div class="card">
      <h2>ğŸ–¼ è§£æè¡Œäº‹æ›†åœ–ç‰‡ <span class="pill">/parse-schedule-image</span></h2>
      <div class="label">ä¸Šå‚³è¡Œäº‹æ›†æˆªåœ–ï¼ˆjpg / pngï¼‰ï¼š</div>
      <input type="file" id="image-input" accept="image/*" />
      <div class="label small">
        åƒè€ƒæ—¥æœŸï¼ˆå¯é¸ï¼‰ï¼š<input type="text" id="image-reference-date-input" placeholder="2025-11-21" />
      </div>
      <button id="image-send">è§£æåœ–ç‰‡</button>
      <div class="output" id="image-output"></div>
      <div id="image-table"></div>
    </div>

    <div class="small">
      å¾Œç«¯ Base URL å¯«æ­»åœ¨å‰ç«¯ JS è£¡ï¼Œåˆå§‹ç‚º <code>http://localhost:8000</code>ï¼Œ
      è‹¥ä¹‹å¾Œä½ æŠŠ FastAPI éƒ¨ç½²åˆ°é›²ç«¯ï¼Œåªè¦æ”¹é‚£å€‹ URL å³å¯ã€‚
    </div>
  </div>

  <script>
    // å¾Œç«¯ API åŸºåº•ç¶²å€ï¼šæœ¬æ©Ÿé–‹ç™¼æ™‚ç”¨ localhost
    const BASE_URL = "http://localhost:8000";

    function renderEventsTable(events) {
      if (!events || events.length === 0) return "<span class='small'>æ²’æœ‰è§£æå‡ºä»»ä½•è¡Œç¨‹ã€‚</span>";

      let rows = events.map(ev => `
        <tr>
          <td>${ev.date || ""}</td>
          <td>${ev.start_time || ""} ~ ${ev.end_time || ""}</td>
          <td>${ev.title || ""}</td>
          <td>${ev.location || ""}</td>
          <td>${ev.source || ""}</td>
        </tr>
      `).join("");

      return `
        <table class="events-table">
          <thead>
            <tr>
              <th>æ—¥æœŸ</th>
              <th>æ™‚é–“</th>
              <th>æ¨™é¡Œ</th>
              <th>åœ°é»</th>
              <th>ä¾†æº</th>
            </tr>
          </thead>
          <tbody>
            ${rows}
          </tbody>
        </table>
      `;
    }

    // ===== ä¸€èˆ¬èŠå¤© =====
    document.getElementById("chat-send").addEventListener("click", async () => {
      const inputEl = document.getElementById("chat-input");
      const outputEl = document.getElementById("chat-output");
      const btn = document.getElementById("chat-send");
      const text = inputEl.value.trim();
      if (!text) return;

      btn.disabled = true;
      outputEl.textContent = "ï¼ˆæ€è€ƒä¸­...ï¼‰";

      try {
        const res = await fetch(`${BASE_URL}/chat`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            message: text,
            context: []
          })
        });
        const data = await res.json();
        outputEl.textContent = data.reply || JSON.stringify(data, null, 2);
      } catch (err) {
        console.error(err);
        outputEl.textContent = "éŒ¯èª¤ï¼šç„¡æ³•é€£ç·šåˆ°å¾Œç«¯ã€‚";
      } finally {
        btn.disabled = false;
      }
    });

    // ===== æ–‡å­—è¡Œç¨‹è§£æ =====
    document.getElementById("schedule-text-send").addEventListener("click", async () => {
      const textEl = document.getElementById("schedule-text-input");
      const refEl = document.getElementById("reference-date-input");
      const outputEl = document.getElementById("schedule-text-output");
      const tableEl = document.getElementById("schedule-text-table");
      const btn = document.getElementById("schedule-text-send");

      const text = textEl.value.trim();
      if (!text) return;

      btn.disabled = true;
      outputEl.textContent = "ï¼ˆè§£æä¸­...ï¼‰";
      tableEl.innerHTML = "";

      try {
        const body = {
          text: text,
          reference_date: refEl.value.trim() || null
        };
        const res = await fetch(`${BASE_URL}/parse-schedule-text`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body)
        });
        const data = await res.json();
        outputEl.textContent = JSON.stringify(data, null, 2);
        tableEl.innerHTML = renderEventsTable(data.events || []);
      } catch (err) {
        console.error(err);
        outputEl.textContent = "éŒ¯èª¤ï¼šç„¡æ³•é€£ç·šåˆ°å¾Œç«¯ã€‚";
      } finally {
        btn.disabled = false;
      }
    });

    // ===== åœ–ç‰‡è¡Œç¨‹è§£æ =====
    document.getElementById("image-send").addEventListener("click", async () => {
      const fileInput = document.getElementById("image-input");
      const refEl = document.getElementById("image-reference-date-input");
      const outputEl = document.getElementById("image-output");
      const tableEl = document.getElementById("image-table");
      const btn = document.getElementById("image-send");

      const file = fileInput.files[0];
      if (!file) return;

      btn.disabled = true;
      outputEl.textContent = "ï¼ˆåœ–ç‰‡ä¸Šå‚³èˆ‡è§£æä¸­...ï¼‰";
      tableEl.innerHTML = "";

      try {
        const formData = new FormData();
        formData.append("image", file);
        const ref = refEl.value.trim();
        if (ref) formData.append("reference_date", ref);

        const res = await fetch(`${BASE_URL}/parse-schedule-image`, {
          method: "POST",
          body: formData
        });
        const data = await res.json();
        outputEl.textContent = JSON.stringify(data, null, 2);
        tableEl.innerHTML = renderEventsTable(data.events || []);
      } catch (err) {
        console.error(err);
        outputEl.textContent = "éŒ¯èª¤ï¼šç„¡æ³•é€£ç·šåˆ°å¾Œç«¯ã€‚";
      } finally {
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>
