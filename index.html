<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>AI åŠ©ç†</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
:root{
--bg:#f5f6fa;
--glass:rgba(255,255,255,.75);
--bubble-user:#2563eb;
--bubble-ai:#ffffff;
--text:#111;
--scan:rgba(0,0,0,.08);
}
body.dark{
--bg:#020617;
--glass:rgba(30,30,30,.7);
--bubble-ai:rgba(40,40,40,.9);
--text:#f9fafb;
--scan:rgba(255,255,255,.15);
}
*{box-sizing:border-box}
body{
margin:0;
height:100vh;
background:var(--bg);
font-family:system-ui;
display:flex;
justify-content:center;
align-items:center;
overflow:hidden;
color:var(--text);
}

/* âœ… æƒæç·šï¼ˆäº®+æš—éƒ½å¯è¦‹ï¼‰ */
body::after{
content:"";
position:fixed;
inset:0;
background:linear-gradient(to bottom,transparent 0%,var(--scan) 50%,transparent 100%);
animation:scan 6s linear infinite;
pointer-events:none;
z-index:0;
}
@keyframes scan{
0%{transform:translateY(-100%)}
100%{transform:translateY(100%)}
}

/* âœ… å´é‚Šæ­·å²æ¬„ */
.history{
position:fixed;
left:-260px;
top:0;
height:100%;
width:260px;
background:var(--glass);
backdrop-filter:blur(14px);
padding:16px;
transition:.3s;
z-index:50;
overflow-y:auto;
}
.history.open{left:0}
.history h3{margin:0 0 10px}
.history div{
font-size:13px;
padding:6px;
border-radius:6px;
cursor:pointer;
}
.history div:hover{background:rgba(0,0,0,.05)}

.app{
width:100%;
max-width:960px;
height:94vh;
border-radius:24px;
background:var(--glass);
backdrop-filter:blur(18px);
box-shadow:0 20px 60px rgba(0,0,0,.25);
display:flex;
flex-direction:column;
overflow:hidden;
position:relative;
z-index:1;
}

.header{
padding:14px;
color:white;
font-weight:bold;
background:#2563eb;
display:flex;
justify-content:space-between;
align-items:center;
}

.chat{
flex:1;
padding:18px;
overflow-y:auto;
-webkit-overflow-scrolling:touch;
}

.message{
display:flex;margin-bottom:12px;
animation:fade .2s ease;
}
.user{justify-content:flex-end}
.assistant{justify-content:flex-start}

.bubble{
padding:12px 16px;
border-radius:18px;
max-width:80%;
background:var(--bubble-ai);
box-shadow:0 6px 16px rgba(0,0,0,.15);
}
.user .bubble{
background:var(--bubble-user);
color:white;
}
.thinking{opacity:.6;animation:blink 1.4s infinite}

.footer{
padding:14px;
border-top:1px solid rgba(0,0,0,.1);
display:flex;
flex-direction:column;
gap:6px;
}
textarea{
resize:none;
padding:10px;
border-radius:10px;
border:none;
font-size:14px;
}
.controls{display:flex;gap:6px}
button{
flex:1;
border:none;
border-radius:999px;
padding:10px;
background:#2563eb;
color:white;
cursor:pointer;
}

.toggle{cursor:pointer;font-size:20px}

@keyframes fade{from{opacity:0;transform:translateY(4px)}to{opacity:1}}
@keyframes blink{0%{opacity:.3}50%{opacity:1}100%{opacity:.3}}
</style>
</head>
<body>

<!-- âœ… æ­·å²å´æ¬„ -->
<div id="history" class="history">
<h3>æ­·å²ç´€éŒ„</h3>
<button onclick="clearAll()">ğŸ—‘ æ¸…é™¤å…¨éƒ¨</button>
<div id="historyList"></div>
</div>

<div class="app">
<div class="header">
âœ¨ AI åŠ©ç†
<div>
<span onclick="toggleHistory()">â˜°</span>
<span id="toggleTheme" class="toggle">ğŸŒ“</span>
</div>
</div>

<div id="chat" class="chat"></div>

<div class="footer">
<textarea id="input" placeholder="è¼¸å…¥æ–‡å­—æˆ–èªéŸ³â€¦"></textarea>
<div class="controls">
<button id="mic">ğŸ¤</button>
<button id="send">é€å‡º</button>
</div>
</div>
</div>

<script>
const BASE_URL="https://schedule-bot-production-32ae.up.railway.app";
const chat=document.getElementById("chat");
const input=document.getElementById("input");
const send=document.getElementById("send");
const mic=document.getElementById("mic");
const toggleTheme=document.getElementById("toggleTheme");
const historyBox=document.getElementById("history");
const historyList=document.getElementById("historyList");

/* âœ… ä¸»é¡Œ */
if(localStorage.theme==="dark")document.body.classList.add("dark");
toggleTheme.onclick=()=>{
document.body.classList.toggle("dark");
localStorage.theme=document.body.classList.contains("dark")?"dark":"light";
};

/* âœ… æ­·å²ç´€éŒ„ */
function toggleHistory(){historyBox.classList.toggle("open")}
function clearAll(){
localStorage.removeItem("chat_history");
chat.innerHTML="";
historyList.innerHTML="";
}

const history=JSON.parse(localStorage.getItem("chat_history")||"[]");
history.forEach(renderHistory);

function renderHistory(item){
const div=document.createElement("div");
div.textContent=item.text;
div.onclick=()=>render(item.role,item.text);
historyList.appendChild(div);
}

function save(role,text){
const data=JSON.parse(localStorage.getItem("chat_history")||"[]");
data.push({role,text});
localStorage.setItem("chat_history",JSON.stringify(data));
renderHistory({role,text});
}

/* âœ… èªéŸ³ */
const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
if(SR){
const recog=new SR();
recog.lang="zh-TW";
mic.onclick=()=>recog.start();
recog.onresult=e=>input.value=e.results[0][0].transcript;
}

/* âœ… å°è©± */
send.onclick=async()=>{
const text=input.value.trim();
if(!text)return;
render("user",text);
save("user",text);
input.value="";
const thinking=render("assistant","â€¦ æ­£åœ¨æ€è€ƒä¸­",true);
try{
const res=await fetch(`${BASE_URL}/chat`,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({message:text})
});
const data=await res.json();
thinking.remove();
typeWriter(data.reply);
}catch{
thinking.textContent="âŒ é€£ç·šå¤±æ•—";
}
};

function render(role,text,loading=false){
const div=document.createElement("div");
div.className=`message ${role}`;
const b=document.createElement("div");
b.className="bubble";
if(loading)b.classList.add("thinking");
b.textContent=text;
div.appendChild(b);
chat.appendChild(div);
chat.scrollTop=chat.scrollHeight;
return b;
}

function typeWriter(text){
const b=render("assistant","");
let i=0;
const timer=setInterval(()=>{
b.textContent+=text[i++]||"";
if(i>=text.length){
clearInterval(timer);
speak(text);
save("assistant",text);
}
},18);
}

function speak(text){
const u=new SpeechSynthesisUtterance(text);
u.lang="zh-TW";
speechSynthesis.speak(u);
}
</script>
</body>
</html>
